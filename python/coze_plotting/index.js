
// 1. 设置内容
let content = `
分镜图7："胖橘猫"身穿简洁的探险家装备，沿着镇里的巷子走着。背景是溫馨的乡镇风光，有着各式各样拱形的门窗和石头铺成的小径，远处是诱人的山丘。
分镜图11：深洞内部的发现；洞内光线昏暗，一束阳光从洞顶的缝隙投射进来，在对面的墙壁上反射出点点金光。"胖橘猫"神情专注地朝着那光亮看去，双眸闪烁着发现新大陆的兴奋。
分镜图12：挖掘宝藏的"胖橘猫"；他站在一个洞壁前，手中的小铲子刨开了藏有一块闪光的古金币的裂缝。"胖橘猫"的表情显露出惊讶，同时还带着一份满足的成就感。
分镜图13：秘密室的门户；"胖橘猫"按下金币，激活了隐藏的机关。洞壁上的一块石头缓缓滑开，露出一个暗门的轮廓。"胖橘猫"身穿他那件独有的探险服，带着兴奋和期待的表情，准备踏入这个未知的密室。
分镜图14：站在密室门口的"胖橘猫"；他的身影显得孤独而勇敢，身后是刚刚打开的密室入口。这个房间充满神秘与古老气息，"胖橘猫"的眼神中透露着对未知的敬畏和探索的热情。
分镜图15：密室内部的探索；室内光线昏黄，一个巨大的书架占据了墙面，上面堆满了尘封的书籍。"胖橘猫"身穿简洁的探险家装备，站在其中一排书前，手轻触一本封面上刻有奇特符号的古老书籍，似乎这本书与众不同，吸引了他所有的注意力。
分镜图16：宝藏地图碎片的发现；书页被翻开，"胖橘猫"的目光紧盯着书中夹着的一块黯淡的宝藏地图碎片。密室内只有柔和的蜡烛光线，"胖橘猫"身着探险服。
分镜图18：急匆匆离开洞穴的"胖橘猫"；洞穴口外天色已晚，但"胖橘猫"面容坚毅，身着探险服，手中紧握着地图和照片，仿佛已经有了明确的目标，向着小镇深处奔去。
分镜图19：抵达图书馆的"胖橘猫"；夜晚的图书馆前，"胖橘猫"站立思考，身着简易的探险服。图书馆的窗户透出温暖的光，"胖橘猫"似乎已经理解这次冒险与寻常的财富无关。
分镜图20：珍贵书籍的发现；图书馆内部安静而幽暗，仅有几盏台灯散发着光芒。"胖橘猫"慢慢靠近书架的一个角落，手中拿着那本记述着小镇历史的珍贵书籍。周围书架散乱，角落灰尘落满，但"胖橘猫"似乎已找到了他的宝藏——小镇的历史和记忆。他穿着一件简单的插肩袖毛衣，适合安静阅读的夜晚。
`
// 分镜图1：宁静的小镇公园描绘；早晨，微光透过树叶投影在长椅上。"胖橘猫"，这位穿着深褐色带有黑色条纹的侦探大衣和佩戴着传统格子图案侦探帽的"胖橘猫"，坐在椅子上，眼睛紧闭，手托下巴，沉浸在思考之中。
// 分镜图2：小镇的街道；"胖橘猫"欢快地行走，穿着深褐色带有黑色条纹的侦探大衣和佩戴着传统格子图案侦探帽。他举起一只爪子朝着远处的邻居挥手。镇上的居民各自忙碌，有的打着伞，有的背着购物袋，但都会抽时间向"胖橘猫"问好，面带微笑。
// 分镜图4：发现线索的"胖橘猫": 在布告栏前，他手里拿着一把老式放大镜，看上去似乎找到了什么线索。他的表情无比兴奋，身穿简洁的探险家装备：宽边帽子，浅棕色的工装外套，准备跳跃般地向下一个目的地出发。
// 分镜图5："胖橘猫"在家中的规划；他坐在书桌前，桌上摊开一张详细的小镇地图，用笔在地图上勾画路线。家中的装饰简约，充满了个人品味，如墙上的艺术画作和摆放整齐的书籍。"胖橘猫"穿着舒适的家居服，专注地制定探险计划。

// 分镜图3："胖橘猫"站在布告栏前；布告栏上贴着一张显眼的海报，描绘的是复古风格的宝藏地图，带有“X”标记和各种神秘符号。"胖橘猫"穿着一件考究的翠绿色夹克，细节到位，仔细观察这张海报，眼神中闪烁着好奇和兴奋。

// 战斗或暴力场景

// 2. 根据 '分镜图图' 标识进行分割
let contentArr = content
  .split("分镜图")
  .map(
    (item) =>
      `请严格根据Prompt要求的内容分析绘制分镜图，分镜图描述中"xxx"描绘的信息为角色，需要严格按照角色形象进行绘制，同时需要确保描绘的动物角色都需要拟人化绘制。画面描述：分镜图${item}`
  );
// """"胖橘猫""""的外观描述为：形象应该是圆润、健壮，体现出一种成熟稳重的风范。他的毛色可能会很丰富，主要以温暖的橘色调为主。
contentArr.shift();
console.log(contentArr);

// 根据类名找到元素
let input_dom = document.querySelector(
  ".M6SqVKIgxzkG926qHtuX .semi-input-textarea.semi-input-textarea-autosize"
);

let intervalId = null;
var isStop = false;

const func = async (i = 0, cycle = 0) => {
  // 如果index已经超过数组长度，那么终止递归
  if (i >= contentArr.length) return;
  if (isStop) return;

  // 4.1. 填入内容
  let setValue = Object.getOwnPropertyDescriptor(
    window.HTMLTextAreaElement.prototype,
    "value"
  ).set;

const content = cycle === 0 ? contentArr[i] : contentArr[i].replace('分析绘制分镜图', '重新绘制分镜图')

  setValue.call(input_dom, content);

  let event = new Event("input", { bubbles: true });

  input_dom.dispatchEvent(event);

  console.time("timer");
  // 4.2. 等待2s
  await new Promise((resolve) => setTimeout(resolve, 5000));
  console.timeEnd("timer");

  // 4.3. 点击元素
  document.querySelector('.chat-uikit-chat-input__input-area__send-button .semi-button').click();

  console.time("timer1");

  // 4.4. 等待10s，检查元素是否存在
  await new Promise(async (resolve) => {
    clearInterval(intervalId);
    intervalId = setInterval(() => {
      let isLoading = !document.querySelector('.hheVvrE0VkdtrwVcvARM');
    if (isStop) return;

      console.log("是否加载中: ", isLoading);
      if (isLoading) {
        clearInterval(intervalId);
        resolve();
      }
    }, 1000 * 10);
  });
  console.timeEnd("timer1");
  // 递归调用：根据cycle数，选择是进入下一循环还是进入下个内容
  cycle < 1 ? await func(i, cycle + 1) : await func(i + 1);
};

func();


// ****************** 超级英雄 ************************
// 分镜图1：胖橘猫毛球坐在屋顶上，凝视远方，深邃的眼神中透露着对冒险的渴望。
// 分镜图2：毛球从屋顶跳下，身边是镇上平静的街道，早晨的阳光洒在身上。
// 分镜图3：毛球在镇上闲逛，无意中发现了一个半掩的地窖门。
// 分镜图4：毛球好奇地推开地窖门，里面黑漆漆的，什么也看不见。
// 分镜图5：毛球戴上了一个小小的头灯，踏入地窖，墙上布满了古老的绘画和符号。
// 分镜图6：随着毛球的探查，一个隐藏的机关被启动，地窖突然露出一个向下的旋转楼梯。
// 分镜图7：毛球沿着楼梯一步步走下去，发现一个光线昏暗但是充满宝藏的古老房间。
// 分镜图8：中心地带放着一个巨大的水晶球，散发着柔和的光芒。
// 分镜图9：毛球走近水晶球，发现球内似乎有些东西在移动。
// 分镜图10：当毛球触摸水晶球时，它突然亮了起来，房间内的宝藏也开始发光。
// 分镜图11：一个虚拟投影显现在毛球面前，展示了一个古代文明的故事。
// 分镜图12：投影中，一个相似的胖橘猫作为英雄，拯救了古文明免于灾难。
// 分镜图13：毛球似懂非懂，却感到受到了某种召唤。
// 分镜图14：毛球退出地窖，天空突然暗了下来，一束光从云层中穿透下来，照在毛球身上。
// 分镜图15：毛球被光束包围，身体渐渐升起，它感到了一种前所未有的力量。
// 分镜图16：毛球发现自己能够操控周围的元素，风、火、水、土都在它的意念中舞动。
// 分镜图17：田野上的农民和镇上的居民惊讶地看着空中的毛球，不敢相信自己的眼睛。
// 分镜图18：毛球将新获得的力量用于拯救小镇，阻止了一次严重的自然灾害。
// 分镜图19：小镇人民庆祝毛球的英雄行为，毛球成了小镇的守护者。
// 分镜图20：故事的最后，毛球站在镇的最高点，身后是金色的夕阳，它似乎明白了自己的命运。