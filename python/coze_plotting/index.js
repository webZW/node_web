// 胖橘猫正在帮小橘猫小橘猫预备去上补习课的东西，他看着矫健灵活正在写作业的小橘猫，那紧锁的小眉头和专注的表情让他想起了自己小时候的情景。
// 那时的他，和一群小伙伴们欢笑玩耍，没有烦恼，没有作业，只有清纯的快乐和探险的激情。
// 那时的他们，常常一起爬树，游荡在森林顶端，享受树梢拂过脸庞的微风。他们下河摸鱼，冰凉的河水让他们忘记了世界的炎热。他们玩玻璃球，那闪闪发光的小巧物品在他们的眼中是无比宝贵的宝石。他们还喜欢玩捉迷藏，躲猫猫，大家嬉笑着追逐，体验无比的快乐。
// 他们会在白皑皑的沙地上扔沙包，那独特的尘土味道和蔓延的欢笑声一起飘荡在柔和的阳光下。他们还会跳绳，小时的他已工巧妙的一个一个跃过绳索，引来同伴们的一片赞叹声。
// 然而，现在的小橘猫却只能在家中上补习班，写作业，那些简单的童年乐趣在他面前像是遥不可及的奢侈。看着小橘猫，他不由得心疼起来，希望这个小家伙，也能体验到他曾经体验过的纯真和快乐。
// 表面上，他还是一如既往的帮小橘猫整理学习用品，做好各种补习班的准备工作，心里面却下定决心，一定要让小橘猫在忙碌的学习之余，也能体验到他们曾经所有的快乐，让他的童年，也能如同自己的那样，充满了欢笑。
// 这就是胖橘猫的回忆，亦是他对小橘猫的期望。他渴望小橘猫在成长的道路上，不仅有知识的灌溉，更有欢快的童年的陪伴，这份期待，也是他对自己的童年最深沉的回忆和珍藏。

// 1. 设置内容
let content = `分镜图1：场景为一个温馨的书房。胖橘猫坐在书桌边上，身旁堆满了彩色笔、作业本和书籍。他穿着一件宽松的灰色针织衫，微笑着从书包中小心地取出钢笔和尺子放在小橘猫的书桌上。房间里弥漫着黄昏时分的暖阳，光影透过窗帘洒在他们身上。
分镜图3：胖橘猫站立在小橘猫旁，倾斜头部观看小橘猫写作业。胖橘猫手中拿着一些学习用品，关注的看着小橘猫学习。
分镜图4：画面中央是胖橘猫和小橘猫沿着繁忙的城市街道走着，周围是匆忙的行人和高楼大厦。胖橘猫穿着整洁的衣物，看起来有些严肃。小橘猫背着沉重的书包，身体略显前倾，面容透露着疲惫，但他仍努力跟上胖橘猫的脚步。表情上，小橘猫略显疲惫，而胖橘猫则是一副忧心忡忡的样子，眉头微蹙。街道的背景要呈现出晚高峰的繁忙状态，反映出城市节奏的快速，从而间接表达社会上的竞争和对个人的压力。灰暗的天空和高挂的路灯都增添了压迫感和日暮时分的沉重气氛。这个画面传达了小橘猫沉重的学习负担和胖橘猫对这种现状的担忧。
分镜图5: 小橘猫抵达了补习班的教室门口，门口挂着一块写着“补习班”字样的标牌。他的身躯被沉甸甸的书包压得低了头，包上堆满了各科的教科书和练习册，显得格外沉重。小橘猫的脸上写满了疲劳和一丝无奈，有明显的重压感。
分镜图6: 胖橘猫站在教室门口的一旁，他的目光跟随着小橘猫慢慢进入教室的背影。胖橘猫的脸上满是复杂的情绪，既有对小橘猫现状的同情，又有一丝自己童年记忆的怅然若失。虽然他的身体保持着直立的姿态，但眼神中流露出柔和的忧郁。背景是校园的一条长廊，沿墙排列着锁着的教室门，墙上挂着学生画作和学习标语，但胖橘猫似乎被自己的回忆吸引，转眼间周围的世界仿佛模糊了。
分镜图10：胖橘猫站在补习班的门口，他的表情坚定而充满爱心，仿佛刚做出了一个重要的决定。
分镜图11：在胖橘猫的身边是萌态可掬的小橘猫，年仅10岁，身体小巧灵活。胖橘猫微笑着伸出一只手轻轻地放在小橘猫的头上，小橘猫穿着一件白色T恤和短裤，眼中闪烁着对世界的好奇和童真的光。请确保这一画面温馨而充满故事性，胖橘猫和小橘猫都应该以拟人化的方式绘制，以丰富的色彩和3D立体风格来表现他们的感情和动作。门口的细节、橘猫身上的衣物纹理以及他们之间的互动都需要被细腻地渲染，以传达出胖橘猫对小橘猫童年快乐时光重要性的决心。整个场景应该散发出温暖和积极的气氛。
分镜图12：胖橘猫与小橘猫并坐在室内的地毯上，手中各执玻璃球，仿佛在玩着一场比赛。地毯上散落着几本打开的书和学习用品，胖橘猫面带微笑，眼中闪烁着童稚的光芒，尽管他体型已经颇为饱满。
分镜图7：背景为一张布满沙尘的沙地和一群猫咪孩子们，在投掷沙包的游戏中欢笑奔跑。胖橘猫（童年时）欢乐地扔着沙包，穿着一件脏兮兮的绿色T恤和破旧的蓝色短裤，饱满的身形在跃跃欲试的姿态中显得特别童趣。
分镜图8：展示青年时期的胖橘猫在树顶俯瞰森林，背景是苍翠的树木和闪烁的阳光。胖橘猫眼神中带有探索的光芒，呈现出孩童时代探索自然的纯真。
分镜图9：一群猫咪孩子们在河边摸鱼的场景，胖橘猫露出欢快的笑容，手中提着满满一提篮的小鱼。傍晚时分的河边，阳光洒在河面上形成斑驳陆离的光点，似乎在给他们带来美丽的祝福。`

// 2. 根据 '分镜图' 标识进行分割
let contentArr = content
  .split("分镜图")
  .map(
    (item) =>
      `请严格根据Prompt绘制分镜图，故事需要将角色的表情和动作拟人化。分镜图描述中"xxx"描绘的信息为角色，需要按照角色形象分析进行绘制，确保角色形象拟人化绘制。画面描述：分镜图${item}`
  );
// ""胖橘猫""的外观描述为：形象应该是圆润、健壮，体现出一种成熟稳重的风范。他的毛色可能会很丰富，主要以温暖的橘色调为主。
contentArr.shift();
console.log(contentArr);

// 根据类名找到元素
let input_dom = document.querySelector(
  ".cBxR8CJK57sitcvBLt_u .semi-input-textarea.semi-input-textarea-autosize"
);

let intervalId = null;
var isStop = false;

const func = async (i = 0, cycle = 0) => {
  // 如果index已经超过数组长度，那么终止递归
  if (i >= contentArr.length) return;
  if (isStop) return;

  // 4.1. 填入内容
  let setValue = Object.getOwnPropertyDescriptor(
    window.HTMLTextAreaElement.prototype,
    "value"
  ).set;

const content = cycle === 0 ? contentArr[i] : contentArr[i].replace('分析绘制分镜图', '重新绘制分镜图')

  setValue.call(input_dom, content);

  let event = new Event("input", { bubbles: true });

  input_dom.dispatchEvent(event);

  console.time("timer");
  // 4.2. 等待2s
  await new Promise((resolve) => setTimeout(resolve, 5000));
  console.timeEnd("timer");

  // 4.3. 点击元素
  document.querySelector(".lgvvFMU_ZtEgFG2Q14nX").click();

  console.time("timer1");

  // 4.4. 等待10s，检查元素是否存在
  await new Promise(async (resolve) => {
    clearInterval(intervalId);
    intervalId = setInterval(() => {
      let isLoading =
        document.querySelector(".HtE_QDTDO5s6h3FZ5MPz").offsetHeight === 0;
    if (isStop) return;

      console.log("是否加载中: ", isLoading);
      if (isLoading) {
        clearInterval(intervalId);
        resolve();
      }
    }, 1000 * 10);
  });
  console.timeEnd("timer1");
  // 递归调用：根据cycle数，选择是进入下一循环还是进入下个内容
  cycle < 1 ? await func(i, cycle + 1) : await func(i + 1);
};

func();

