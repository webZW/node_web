<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>路径飞行</title>
  <link rel="stylesheet"  href="./geomap-api/JsCodeDemo_new/css/mapbox-gl.css" />
  <script src="./geomap-api/JsCodeDemo_new/js/mapbox-gl.js"></script>
  <script src="./geomap-api/JsCodeDemo_new/js/GeoGlobeJS.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
    }
    html,
    body,
    #map {
      height: 100%;
    }
  </style>
</head>

<body>
<div id="map"></div>

<script>
  // 创建地图对象实例，默认坐标系为经纬度
  var map = new GeoGlobe.Map({ mapCRS: {
      topTileExtent: [-180, -270, 180, 90],
      coordtransform: 'none'
    }, container: 'map' });

  // 添加天地图
  map.on('load', function(e) {
    var token = 'e90d56e5a09d1767899ad45846b0cefd';
    var layer_vtc = new GeoGlobe.TDTLayer('vec_c', token);
    var layer_cva = new GeoGlobe.TDTLayer('cva_c', token);
    map.addLayer(layer_vtc);
    map.addLayer(layer_cva);
  });

  map.on('load', function() {
    // 测试路径
    var Path = [
      [117.14873093111817, 34.27711885568744, 1],
      [117.14987888452941, 34.277897630202524, 2],
      [117.15153827751908, 34.278014961020276, 3],
      [117.15250206637819, 34.27786410711203, 4],
      [117.15342395137401, 34.27734449920539, 5],
      [117.15399384391685, 34.27687517593523, 6],
      [117.15439612100403, 34.2764645180738, 7],
      [117.15456373645969, 34.275944910167155, 8],
      [117.15447992873305, 34.275534252305725, 9],
      [117.15402736700702, 34.275014644399384, 10],
      [117.15287920114832, 34.27515711753509, 10],
      [117.1517729391552, 34.275986814030794, 1],
      [117.15073372334251, 34.27623823721112, 1],
      [117.14954365362036, 34.27602033712129, 1],
      [117.14941794203031, 34.27530797144335, 1],
      [117.14971964984682, 34.27465427117385, 1],
      [117.15070020025229, 34.27410952094956, 1],
      [117.15215845469834, 34.27407599785876, 1],
      [117.15372565919057, 34.27397542858639, 1],
      [117.15529286368275, 34.2743274210391, 1],
      [117.15557780995294, 34.27560967925985, 1],
      [117.15584599467923, 34.277336118432835, 1]
    ];

    map.addLayer({
      id: 'testline2',
      type: 'line',
      paint: {
        'line-color': 'red',
        'line-opacity': 0.6,
        'line-width': 4
      },
      source: {
        type: 'geojson',
        data: { type: 'LineString', coordinates: Path }
      }
    });
    var marker = new mapboxgl.Marker()
            .setLngLat(Path[0])
            .addTo(map);

    // 新建飞行路径对象
    flyRoute = new mapboxgl.RouteFly(Path, [16, 20]);
    // 绑定更新函数
    flyRoute.update = function(center) {
      marker.setLngLat(center);
    };
    // 加入到地图对象中
    flyRoute.addTo(map);

    // 开始路径播放
    setTimeout(function() {
      flyRoute.play();
    }, 2000);
  });
</script>
</body>
</html>
