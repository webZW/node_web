<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>符号分级渲染</title>

    <link rel="stylesheet" href="./geomap-api/JsCodeDemo_new/css/mapbox-gl.css"/>
    <script src="./geomap-api/JsCodeDemo_new/js/mapbox-gl.js"></script>
    <script src="./geomap-api/JsCodeDemo_new/js/GeoGlobeJS.min.js"></script>
    <script src="./geomap-api/JsCodeDemo_new/public/Layers/data.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        html,
        body,
        #map {
            height: 100%;
        }

        .legend {
            background-color: #fff;
            border-radius: 3px;
            bottom: 30px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            padding: 10px;
            position: absolute;
            right: 10px;
            z-index: 1000;
        }

        .legend h4 {
            margin: 0 0 10px;
        }

        .legend div span {
            border-radius: 50%;
            display: inline-block;
            height: 10px;
            margin-right: 5px;
            width: 10px;
        }
    </style>
</head>
<body>
<div id="map"></div>
<div id="state-legend" class="legend">
    <h4>Population</h4>
    <div>
        <span style="background-color: #723122;"></span>
        25,000,000
    </div>
    <div>
        <span style="background-color: #8b4225;"></span>
        10,000,000
    </div>
    <div>
        <span style="background-color: #a25626;"></span>
        7,500,000
    </div>
    <div>
        <span style="background-color: #b86b25;"></span>
        5,000,000
    </div>
    <div>
        <span style="background-color: #ca8323;"></span>
        2,500,000
    </div>
    <div>
        <span style="background-color: #da9c20;"></span>
        1,000,000
    </div>
    <div>
        <span style="background-color: #e6b71e;"></span>
        750,000
    </div>
    <div>
        <span style="background-color: #eed322;"></span>
        500,000
    </div>
    <div>
        <span style="background-color: #f2f12d;"></span>
        0
    </div>
</div>
<script>
    var map = new GeoGlobe.Map({
        container: 'map',
        zoom: 4,
        center: [-93.8427, 35.0819]
    });

    var popup = new GeoGlobe.Popup({  closeButton: true, closeOnClick: true });

    const list = [
                        [0, '#F2F12D'],
                        [500000, '#EED322'],
                        [750000, '#E6B71E'],
                        [1000000, '#DA9C20'],
                        [2500000, '#CA8323'],
                        [5000000, '#B86B25'],
                        [7500000, '#A25626'],
                        [10000000, '#8B4225'],
                        [25000000, '#723122']
                    ];

    map.on('load', function () {
        map.addSource('population', {
            type: 'geojson',
            data: testgrid
        });
        map.addLayer({
            id: 'state-population',
            source: 'population',
            maxzoom: 20,
            type: 'fill',
            filter: ['==', 'isState', 'true'],
            paint: {
                'fill-color': {
                    property: 'population',
                    stops: [
                        [0, '#F2F12D'],
                        [500000, '#EED322'],
                        [750000, '#E6B71E'],
                        [1000000, '#DA9C20'],
                        [2500000, '#CA8323'],
                        [5000000, '#B86B25'],
                        [7500000, '#A25626'],
                        [10000000, '#8B4225'],
                        [25000000, '#723122']
                    ]
                },
                'fill-opacity': 0.75
            }
        });

        map.on('mousemove', 'state-population', function(e) {
            console.log(4455, e);
                console.log('e.features: ', e.features);
                var coordinates = e.features[0].geometry.coordinates.slice();
                const lngList = [e.lngLat.lng, e.lngLat.lat];
                const desc = `population: ${e.features[0].properties.population}_${new Date().getTime()}`;

                popup.setLngLat(lngList).setHTML(desc).addTo(map);
        });
        
        map.on('mouseleave', 'state-population', function() {
            map.getCanvas().style.cursor = '';
            popup.remove();
        });
    });
    
    // for (const item of list) {
    //     const id = `state-population-${item[0]}`;
    //     console.log(item, id);
    //     map.on('load', function () {
    //         map.addSource('population', {
    //             type: 'geojson',
    //             data: testgrid
    //         });
    //         map.addLayer({
    //             id: id,
    //             source: 'population',
    //             maxzoom: 20,
    //             type: 'fill',
    //             filter: ['==', 'isState', 'true'],
    //             paint: {
    //                 'fill-color': {
    //                     property: 'population',
    //                     stops: [
    //                         item
    //                     ]
    //                 },
    //                 'fill-opacity': 0.75
    //             }
    //         }).on('mouseenter', id, (e) => {
    //             console.log(112233);
    //         });
    //     })
    // }
</script>
</body>
</html>
